{% extends "base.html" %}
{% block title %}{{ receipt.receipt_number }}{% endblock %}
{% block content %}
<div class="header-row">
    <h1>Receipt: {{ receipt.receipt_number }}</h1>
    <div>
        <a href="{{ url_for('receipts.download_pdf', id=receipt.id) }}" class="btn btn-success">
            ðŸ“„ Download PDF
        </a>
        <a href="{{ url_for('receipts.index') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
    </div>
</div>

<div class="section">
    <h2>Receipt Details</h2>
    <div class="row">
        <div class="col-md-6">
            <table class="table table-bordered">
                <tr>
                    <th style="width: 40%;">Receipt Number:</th>
                    <td>{{ receipt.receipt_number }}</td>
                </tr>
                <tr>
                    <th>Source Type:</th>
                    <td>
                        <span class="badge badge-primary">
                            {{ receipt.source_type.replace('_', ' ').title() }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <th>Location:</th>
                    <td>{{ receipt.location.name }}</td>
                </tr>
                <tr>
                    <th>Received Date:</th>
                    <td>{{ receipt.received_date.strftime('%Y-%m-%d %H:%M') }}</td>
                </tr>
            </table>
        </div>
        <div class="col-md-6">
            <table class="table table-bordered">
                {% if receipt.po_id %}
                <tr>
                    <th style="width: 40%;">Purchase Order:</th>
                    <td>
                        <a href="{{ url_for('purchase_orders.view', id=receipt.po_id) }}">
                            {{ receipt.purchase_order.po_number }}
                        </a>
                    </td>
                </tr>
                <tr>
                    <th>Supplier:</th>
                    <td>{{ receipt.purchase_order.supplier.name }}</td>
                </tr>
                {% elif receipt.internal_order_number %}
                <tr>
                    <th style="width: 40%;">Internal Order:</th>
                    <td>{{ receipt.internal_order_number }}</td>
                </tr>
                {% elif receipt.external_process_id %}
                <tr>
                    <th style="width: 40%;">External Process:</th>
                    <td>
                        <a href="{{ url_for('external_processes.view', id=receipt.external_process_id) }}">
                            {{ receipt.external_process.process_number }}
                        </a>
                    </td>
                </tr>
                <tr>
                    <th>Supplier:</th>
                    <td>{{ receipt.external_process.supplier.name }}</td>
                </tr>
                {% endif %}
                <tr>
                    <th>Created:</th>
                    <td>{{ receipt.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                </tr>
            </table>
        </div>
    </div>

    {% if receipt.notes %}
    <div class="mt-3">
        <h3>Notes</h3>
        <div class="alert alert-info">
            {{ receipt.notes }}
        </div>
    </div>
    {% endif %}
</div>

<div class="section">
    <h2>Items Received</h2>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>Item Name</th>
                    <th>Total Received</th>
                    <th>Scrap Qty</th>
                    <th>Good Qty</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for item in receipt.items %}
                <tr>
                    <td>
                        <a href="{{ url_for('items.view', id=item.item.id) }}">
                            {{ item.item.sku }}
                        </a>
                    </td>
                    <td>{{ item.item.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>
                        {% if item.scrap_quantity > 0 %}
                            <span class="badge badge-danger">{{ item.scrap_quantity }}</span>
                        {% else %}
                            <span class="text-muted">0</span>
                        {% endif %}
                    </td>
                    <td><strong>{{ item.quantity - item.scrap_quantity }}</strong></td>
                    <td>
                        {% if item.scrap_quantity > 0 %}
                            <span class="badge badge-warning">Partial Scrap</span>
                        {% else %}
                            <span class="badge badge-success">All Good</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                <tr class="table-active">
                    <td colspan="2"><strong>Totals:</strong></td>
                    <td><strong>{{ receipt.items | sum(attribute='quantity') }}</strong></td>
                    <td><strong>{{ receipt.items | sum(attribute='scrap_quantity') }}</strong></td>
                    <td><strong>{{ receipt.items | sum(attribute='quantity') - receipt.items | sum(attribute='scrap_quantity') }}</strong></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<style>
.badge {
    padding: 5px 10px;
    border-radius: 3px;
    font-size: 12px;
}
.badge-primary {
    background-color: #007bff;
    color: white;
}
.badge-success {
    background-color: #28a745;
    color: white;
}
.badge-warning {
    background-color: #ffc107;
    color: black;
}
.badge-danger {
    background-color: #dc3545;
    color: white;
}
.table-active {
    background-color: #f8f9fa;
}
</style>
{% endblock %}
