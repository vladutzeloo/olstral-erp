{% extends "base.html" %}

{% block title %}Stock Movements - Inventory ERP{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Stock Movements</h1>
    <div class="page-actions">
        <a href="{{ url_for('stock_movements.new') }}" class="btn btn-primary">Move Stock</a>
    </div>
</div>

<div class="card">
    <h3>Filter Movements</h3>
    <form method="GET" action="{{ url_for('stock_movements.index') }}" class="filter-form">
        <div class="form-row">
            <div class="form-group">
                <label for="item_id">Filter by Item</label>
                <select id="item_id" name="item_id" class="form-control">
                    <option value="">All Items</option>
                    {% for item in items %}
                    <option value="{{ item.id }}" {% if selected_item == item.id %}selected{% endif %}>
                        {{ item.sku }} - {{ item.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="location_id">Filter by Location</label>
                <select id="location_id" name="location_id" class="form-control">
                    <option value="">All Locations</option>
                    {% for location in locations %}
                    <option value="{{ location.id }}" {% if selected_location == location.id %}selected{% endif %}>
                        {{ location.code }} - {{ location.name }}
                        {% if location.zone %}({{ location.zone }}){% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group" style="align-self: flex-end;">
                <button type="submit" class="btn btn-secondary">Filter</button>
                <a href="{{ url_for('stock_movements.index') }}" class="btn btn-secondary">Clear</a>
            </div>
        </div>
    </form>
</div>

<div class="card">
    <table class="data-table">
        <thead>
            <tr>
                <th>Movement #</th>
                <th>Date</th>
                <th>Item</th>
                <th>From Location</th>
                <th>To Location</th>
                <th>Quantity</th>
                <th>Type</th>
                <th>Reason</th>
                <th>Moved By</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if movements %}
                {% for movement in movements %}
                <tr>
                    <td><a href="{{ url_for('stock_movements.view', id=movement.id) }}">{{ movement.movement_number }}</a></td>
                    <td>{{ movement.moved_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <strong>{{ movement.item.sku }}</strong><br>
                        <small>{{ movement.item.name }}</small>
                    </td>
                    <td>
                        {{ movement.from_location.code }}<br>
                        <small>{{ movement.from_location.name }}</small>
                        {% if movement.from_location.zone %}
                        <br><span class="badge badge-secondary">{{ movement.from_location.zone }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ movement.to_location.code }}<br>
                        <small>{{ movement.to_location.name }}</small>
                        {% if movement.to_location.zone %}
                        <br><span class="badge badge-secondary">{{ movement.to_location.zone }}</span>
                        {% endif %}
                    </td>
                    <td><strong>{{ movement.quantity }}</strong> {{ movement.item.unit_of_measure }}</td>
                    <td><span class="badge badge-info">{{ movement.movement_type }}</span></td>
                    <td>{{ movement.reason or '-' }}</td>
                    <td>{{ movement.user.username if movement.user else 'System' }}</td>
                    <td>
                        <span class="badge badge-{{ 'success' if movement.status == 'completed' else 'warning' }}">
                            {{ movement.status|upper }}
                        </span>
                    </td>
                    <td>
                        <a href="{{ url_for('stock_movements.view', id=movement.id) }}" class="btn btn-sm btn-info">View</a>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="11" class="text-center">
                        <p>No stock movements found.</p>
                        <a href="{{ url_for('stock_movements.new') }}" class="btn btn-primary">Create First Movement</a>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<style>
.filter-form .form-row {
    display: flex;
    gap: 15px;
    align-items: flex-end;
}
.filter-form .form-group {
    flex: 1;
}
</style>
{% endblock %}
